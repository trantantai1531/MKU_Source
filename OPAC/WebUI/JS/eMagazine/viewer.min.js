function getXY() { var result = new Object(); var offSetTop = 0.009, offSetLeft = 0.005; return result.left = iipmooviewer.wid < iipmooviewer.view.w ? 0.25 : (iipmooviewer.view.x + iipmooviewer.view.w / (7 * 2)) / iipmooviewer.wid - offSetLeft, result.top = iipmooviewer.hei < iipmooviewer.view.h ? 0.25 : (iipmooviewer.view.y + iipmooviewer.view.h / (7 * 2)) / iipmooviewer.hei - offSetTop, result.docId = 0, result.fileId = 0, result; } function moveXY(xk, yk) { var offset = 10; var x, y; x = Math.round(xk * iipmooviewer.wid) - iipmooviewer.view.res * offset, y = Math.round(yk * iipmooviewer.hei) - offset, moveTo(x, y); } function moveXYTocAll(x, y, p) { var hidMagPage = document.getElementById('hidMagPage'); var iPage = hidMagPage.value; if (iPage == p) moveXY(x, y), closePanelTocAll(); else { var hidMagId = document.getElementById('hidMagId'); var magId = hidMagId.value; var hidDocId = document.getElementById('hidDocId'); var docId = hidDocId.value; var hidYear = document.getElementById('hidYear'); var year = hidYear.value; var strUrl = 'OViewerMagazine.aspx?MagId=' + magId + '&ItemID=' + docId + '&page=' + p + '&X=' + x.toString() + '&Y=' + y.toString(); year > 0 && (strUrl = strUrl + '&year=' + year), location.href = strUrl; } } function gotoPages(x, y, p) { var hidMagPage = document.getElementById('hidMagPage'); var iPage = hidMagPage.value; if (iPage == p) moveTo(x, y), closePanelTocAll(); else { var hidMagId = document.getElementById('hidMagId'); var magId = hidMagId.value; var hidDocId = document.getElementById('hidDocId'); var docId = hidDocId.value; var hidYear = document.getElementById('hidYear'); var year = hidYear.value; var strUrl = 'OViewerMagazine.aspx?MagId=' + magId + '&ItemID=' + docId + '&page=' + p + '&X=' + x.toString() + '&Y=' + y.toString(); year > 0 && (strUrl = strUrl + '&year=' + year), location.href = strUrl; } } function moveTo(x, y) { iipmooviewer.moveTo(x, y); } function closePanelTocAll() { jQuery('#panelTableOfContentsAll').panel('close'); } function gotoPrevious() { var hidMagId = document.getElementById('hidMagId'); magId = hidMagId.value; var hidDocId = document.getElementById('hidDocId'); docId = hidDocId.value; var hidYear = document.getElementById('hidYear'); magYear = hidYear.value; var num = parseInt(magPage); if (num > 1) { num -= 1; var strUrl = 'OViewerMagazine.aspx?MagId=' + magId + '&ItemID=' + docId + '&page=' + num; magYear > 0 && (strUrl = strUrl + '&year=' + magYear), location.href = strUrl; } else alert(span_warning_previous_page.innerHTML); } function gotoHome() { location.href = 'OIndex.aspx'; } function Fullscreen() { iipmooviewer.toggleFullScreen(); } function ShowhideWindows() { iipmooviewer.toggleNavigationWindow(); } function gotoNext() { var hidMagId = document.getElementById('hidMagId'); magId = hidMagId.value; var hidDocId = document.getElementById('hidDocId'); docId = hidDocId.value; var hidYear = document.getElementById('hidYear'); magYear = hidYear.value; var num = parseInt(magPage); if (num < parseInt(magPageCounts)) { num += 1; var strUrl = 'OViewerMagazine.aspx?MagId=' + magId + '&ItemID=' + docId + '&page=' + num; magYear > 0 && (strUrl = strUrl + '&year=' + magYear), location.href = strUrl; } else alert(span_warning_next_page.innerHTML); } function gotoXY() { var hidCoordinatesX = document.getElementById('hidCoordinatesX'); var fCoordinatesX = parseFloat(hidCoordinatesX.value); var hidCoordinatesY = document.getElementById('hidCoordinatesY'); var fCoordinatesY = parseFloat(hidCoordinatesY.value); if (fCoordinatesX > 0 || fCoordinatesY > 0) { var offset = 10; var x, y; x = Math.round(fCoordinatesX * iipmooviewer.wid) - iipmooviewer.view.res * offset, y = Math.round(fCoordinatesY * iipmooviewer.hei) - offset, moveTo(x, y); } } function getTOCAll(magId) { var serviceURL = 'eService.asmx/getTocAll'; var str = ''; var jqxhrTocAll = jQuery.ajax({ url: serviceURL, type: 'GET', contentType: 'application/json; charset=utf-8', data: { magId: magId }, dataType: 'json', success: function (json) { if (json.length > 0) { for (str = str + '<li data-role="list-divider" data-theme="c" style="height:23px">T\u1ed5ng m\u1ee5c l\u1ee5c c\xe1c trang<span class="ui-li-count">' + json.length + '</span></li>', i = 0; i < json.length; i++) str = str + '<li><a href="' + 'javascript:moveXYTocAll(' + json[i].coordinatesX + ',' + json[i].coordinatesY + ',' + json[i].PageNum + ')">', str = str + '<h2>' + json[i].SubjectName + '</h2>', str = str + '<p><strong>' + json[i].AuthorName + '</strong></p>', str = str + '<p>' + (i + 1).toString() + '. ' + json[i].Overview + '</p>', str = str + '<span class="ui-li-count">Tr.' + json[i].PageNum + '</span>', str += '</a></li>'; jQuery('#lstTableOfContentsAll').append(str), jQuery('#lstTableOfContentsAll').listview('refresh'); } else str = str + '<li data-role="list-divider" data-theme="c" style="height:23px">T\u1ed5ng m\u1ee5c l\u1ee5c c\xe1c trang<span class="ui-li-count">' + json.length + '</span></li>', str += '<li><p>Kh\xf4ng c\xf3 d\u1eef li\u1ec7u</p></li>', jQuery('#lstTableOfContentsAll').append(str), jQuery('#lstTableOfContentsAll').listview('refresh'); }, error: function () { jQuery('#lstTableOfContentsAll').append('<li><p>L\u1ed7i k\u1ebft n\u1ed1i d\u1eef li\u1ec7u</p></li>'), jQuery('#lstTableOfContentsAll').listview('refresh'); } }); jqxhrTocAll.complete(function () { }); } function showData() { var intResolution = getCookie('resIIP'); var hidMagFilePath = document.getElementById('hidMagFilePath'); magFile = hidMagFilePath.value; var hidMagPage = document.getElementById('hidMagPage'); magPage = hidMagPage.value; var hidMagPageCount = document.getElementById('hidMagPageCount'); magPageCounts = hidMagPageCount.value; var hidIIPServer = document.getElementById('hidIIPServer'); magServer = hidIIPServer.value, iipmooviewer = new IIPMooViewer('viewer', { server: magServer, image: magFile, credit: magTitle, navigation: { draggable: !0, buttons: ['zoomIn', 'zoomOut', 'reset'] }, showCoords: !1, viewport: { resolution: intResolution, x: 0.5, y: 0.5, rotation: 0 }, annotations: annotations }); var hidMagId = document.getElementById('hidMagId'); magId = hidMagId.value, getTOCAll(magId), iipmooviewer.addEvent('load', function () { var strShowNavWinIIP = getCookie('showNavWinIIP'); strShowNavWinIIP == 'none' && iipmooviewer.toggleNavigationWindow(), gotoXY(); }); } function getAnnotations(magId) { var serviceURL = 'eService.asmx/getAnnotation'; var str = ''; var jAnnotations = {}; var element = Object(); var jqxhrAnnotation = jQuery.ajax({ url: serviceURL, type: 'GET', contentType: 'application/json; charset=utf-8', data: { magId: magId }, dataType: 'json', success: function (json) { if (json.length > 0) for (i = 0; i < json.length; i++) element = new Object(), element.x = json[i].coordinatesX, element.y = json[i].coordinatesY, element.w = json[i].aWidth, element.h = json[i].aHeight, element.text = json[i].lnk, element.title = json[i].title, jAnnotations[json[i].aId] = element; }, error: function () { } }); jqxhrAnnotation.complete(function () { annotations = jAnnotations, showData(); }); } var iipmooviewer; var annotations = {}; $.noConflict(), jQuery(document).ready(function ($) { var hidMagDetailId = document.getElementById('hidMagDetailId'); magDetailId = hidMagDetailId.value, getAnnotations(magDetailId); });